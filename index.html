<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ERJ — Raporty i Administracja</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>
<body>
  <div class="container py-4" id="root">

    <!-- LOGIN -->
    <div id="loginView" class="card mx-auto" style="max-width:520px;">
      <div class="card-body">
        <h4 class="card-title mb-3">Zaloguj się do systemu ERJ</h4>
        <form id="loginForm" class="mb-2" autocomplete="on">
          <div class="mb-2">
            <label class="form-label small">Login (email lub numer służbowy)</label>
            <input id="loginId" class="form-control" autocomplete="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label small">Hasło</label>
            <input id="loginPassword" type="password" class="form-control" autocomplete="current-password" required>
          </div>
          <div class="d-flex gap-2">
            <button id="loginBtn" type="submit" class="btn btn-primary">Zaloguj</button>
            <button id="demoBtn" type="button" class="btn btn-outline-secondary">Demo (admin)</button>
          </div>
        </form>
        <div id="loginMsg" class="text-danger small mt-2"></div>
      </div>
    </div>

    <!-- APP (ukryte do czasu logowania) -->
    <div id="appShell" style="display:none;">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h3 class="mb-0">ERJ — System raportów</h3>
          <div class="small text-muted" id="loggedUserInfo"></div>
        </div>
        <div>
          <button id="btnLogout" type="button" class="btn btn-outline-danger btn-sm">Wyloguj</button>
        </div>
      </div>

      <!-- Główne panele: start, raport, admin -->
      <div id="mainPanels">
        <!-- Start panel -->
        <div id="startPanel" class="card p-3 mb-3">
          <h5>Panel startowy</h5>
          <div class="row g-2 mb-2">
            <div class="col-12 col-md-8">
              <input id="userName" class="form-control" placeholder="Imię i nazwisko" />
            </div>
            <div class="col-12 col-md-4">
              <input id="userId" class="form-control" placeholder="Numer służbowy" />
            </div>
          </div>
          <div class="d-flex gap-2">
            <button id="newReportBtn" type="button" class="btn btn-primary">Otwórz nowy raport</button>
            <button id="takeReportBtn" type="button" class="btn btn-outline-secondary">Przejmij raport</button>
            <button id="openAdminBtn" type="button" class="btn btn-outline-info">Panel administracyjny</button>
          </div>
        </div>

        <!-- Report panel (minimalny placeholder) -->
        <div id="reportPanel" class="mb-3" style="display:none;">
          <div class="card p-3">
            <div class="d-flex justify-content-between align-items-start">
              <h4 class="mb-0">Raport z jazdy pociągu</h4>
              <div class="text-end">
                <div><strong id="reportNumber" class="badge bg-secondary fs-6"></strong></div>
                <div class="small text-muted" id="currentUser"></div>
              </div>
            </div>
            <hr>
            <div id="sections" class="mb-3">
              <div id="sectionA" class="mb-3 card p-3"><h5>A - Dane ogólne</h5></div>
            </div>
            <div class="d-flex justify-content-between">
              <div><button id="closeReport" type="button" class="btn btn-danger btn-sm">Zamknij raport</button></div>
            </div>
          </div>
        </div>

        <!-- Admin panel (tylko dla adminów) -->
        <div id="adminPanel" class="card p-3 mb-3" style="display:none;">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Panel administracyjny</h5>
            <button id="addUserBtn" type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalUser">Dodaj użytkownika</button>
          </div>
          <hr>
          <div id="usersTableContainer" class="table-responsive">
            <table class="table table-sm table-hover" id="usersTable">
              <thead class="table-light"><tr><th>Imię i nazwisko</th><th>Nr służbowy</th><th>ZDP</th><th>Email</th><th>Rola</th><th>Status</th><th>Akcje</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal: Add/Edit User -->
  <div class="modal fade" id="modalUser" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="formUser" class="modal-content" data-mode="add" data-index="">
        <div class="modal-header">
          <h5 class="modal-title">Dodaj użytkownika</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2"><label class="form-label">Imię i nazwisko</label><input id="u_name" class="form-control" required></div>
          <div class="mb-2"><label class="form-label">Numer służbowy</label><input id="u_id" class="form-control" required></div>
          <div class="mb-2"><label class="form-label">ZDP</label>
            <select id="u_zdp" class="form-select">
              <option>WAW</option><option>KRK</option><option>GDY</option><option>POZ</option>
            </select>
          </div>
          <div class="mb-2"><label class="form-label">Email</label><input id="u_email" type="email" class="form-control" required></div>
          <div class="mb-2"><label class="form-label">Hasło</label><input id="u_password" type="password" class="form-control" required></div>
          <div class="mb-2"><label class="form-label">Rola</label>
            <select id="u_role" class="form-select">
              <option value="user">Użytkownik</option>
              <option value="admin">Administrator</option>
            </select>
          </div>
          <div class="mb-2"><label class="form-label">Status</label>
            <select id="u_status" class="form-select">
              <option value="active">Aktywny</option>
              <option value="inactive">Nieaktywny</option>
            </select>
          </div>
          <div id="userFormMsg" class="small text-danger"></div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Zapisz</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="js/db.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/app.js"></script>
</body>
</html>
